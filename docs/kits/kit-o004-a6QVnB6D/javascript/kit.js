import*as t from"../../../vendor/three/javascript/three.module.js";const e=class{static createBlobFromCanvas(t){return new Promise((function(e){t.toBlob(e)}))}static createColorFromValue(e){const i=e%256,s=Math.trunc((e-i)%65536/256),a=Math.trunc((e-256*s-i)%16777216/65536);return new t.Color("rgb("+i+", "+s+", "+a+")")}static createMaterialFromValue(i){const s=e.createColorFromValue(i);return new t.MeshBasicMaterial({color:s})}},i=class extends t.Object3D{constructor(t,i,s){super(),this.pieceIndexPlusOne=s;let a=101*this.pieceIndexPlusOne;this.sidesMaterial=e.createMaterialFromValue(a),this.topUnitsMaterials=[];for(let s=0;s<t;s++){this.topUnitsMaterials[s]=[];for(let t=0;t<i;t++)this.topUnitsMaterials[s][t]=e.createMaterialFromValue(a+s*i+t+1)}this.changePieceIndex=s=>{this.pieceIndexPlusOne=s;let a=101*this.pieceIndexPlusOne;this.sidesMaterial.color=e.createColorFromValue(a);for(let s=0;s<t;s++)for(let t=0;t<i;t++)this.topUnitsMaterials[s][t].color=e.createColorFromValue(a+s*i+t+1)}}},s=class{constructor(t,e,i){this.width=t,this.height=e,this.depth=i}},a=Math.PI/2,h=class extends s{constructor(s,h,r,n,c,o,u,w,d,p,v){super(s,h,r),this.getVolume=(t,e,i)=>1,this.createSceneObject=e=>{const i=this.width/2,s=this.height/2,a=1.2*this.depth,h=a/2,r=new t.Object3D;if(void 0!==o){const e=l(this.height,a),s=new t.Mesh(e,n.get(o));f.putOnRight(h,i,s,r)}if(void 0!==u){const e=l(this.height,a),s=new t.Mesh(e,n.get(u));f.putOnLeft(h,i,s,r)}if(void 0!==w){const e=l(this.width,a),i=new t.Mesh(e,n.get(w));f.putOnBack(h,s,i,r)}if(void 0!==d){const e=l(this.width,a),i=new t.Mesh(e,n.get(d));f.putOnFront(h,s,i,r)}if(void 0!==p){const e=l(this.height,this.width),i=new t.Mesh(e,n.get(p));f.putOnUp(a,i,r)}if(void 0!==v){const e=l(this.height,this.width),i=new t.Mesh(e,n.get(v));f.putOnDown(i,r)}return void 0!==c&&c(r),f.positionBrickObject(r,e,i,s,!1),r},this.createPickingSceneObject=(e,s)=>{const a=this.width/2,h=this.height/2,r=1.2*this.depth,n=r/2,c=new i(this.width,this.height,s),o=c.sidesMaterial,u=c.topUnitsMaterials,w=l(this.height,r),d=new t.Mesh(w,o);f.putOnRight(n,a,d,c);const p=l(this.height,r),v=new t.Mesh(p,o);f.putOnLeft(n,a,v,c);const M=l(this.width,r),g=new t.Mesh(M,o);f.putOnBack(n,h,g,c);const O=l(this.width,r),b=new t.Mesh(O,o);f.putOnFront(n,h,b,c);for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++){const s=u[e][i],n=l(1,1),o=new t.Mesh(n,s);o.translateX(.5-a+e),o.translateY(h-.5-i),f.putOnUp(r,o,c)}const P=l(this.height,this.width),B=new t.Mesh(P,o);return f.putOnDown(B,c),f.positionBrickObject(c,e,a,h,!1),c},this.createBaseSceneObject=(e,i)=>{const s=this.width/2,h=this.height/2,r=new t.Object3D;let c=0;for(let e=0;e<this.width;e++)for(let s=0;s<this.height;s++){c++;const h=l(1,1),o=new t.Mesh(h,c===i?n.get("BaseUnitSelected"):n.get("BaseUnit"));o.translateX(-this.width/2+.5+e),o.translateY(this.height/2-.5-s),o.rotateZ(a),r.add(o)}return f.positionBrickObject(r,e,s,h,!0),r},this.createPickingBaseSceneObject=i=>{const s=this.width/2,h=this.height/2,r=new t.Object3D;let n=0;for(let i=0;i<this.width;i++)for(let s=0;s<this.height;s++){n++;const h=e.createMaterialFromValue(n),c=l(1,1),o=new t.Mesh(c,h);o.translateX(-this.width/2+.5+i),o.translateY(this.height/2-.5-s),o.rotateZ(a),r.add(o)}return f.positionBrickObject(r,i,s,h,!0),r}}},r=Math.PI/2,n=class extends s{constructor(s,a,h,n){super(s,a,0),this.getVolume=(t,e,i)=>0,this.createSceneObject=e=>{const i=this.width/2,s=this.height/2,a=new t.Object3D,c=l(this.height,this.width),o=new t.Mesh(c,h.get(n));o.translateZ(.01),o.rotateZ(r),a.add(o);const u=l(this.height,this.width),w=new t.Mesh(u,h.get(n));return f.putOnDown(w,a),f.positionBrickObject(a,e,i,s,!1),a},this.createPickingSceneObject=(e,h)=>{const n=this.width/2,c=this.height/2,o=new i(s,a,h),u=o.sidesMaterial,w=o.topUnitsMaterials;for(let e=0;e<s;e++)for(let i=0;i<a;i++){const s=w[e][i],a=l(1,1),h=new t.Mesh(a,s);h.translateX(.5-n+e),h.translateY(c-.5-i),h.translateZ(.01),h.rotateZ(r),o.add(h)}const d=l(a,s),p=new t.Mesh(d,u);return f.putOnDown(p,o),f.positionBrickObject(o,e,n,c,!1),o},this.createBaseSceneObject=(e,i)=>{const s=this.width/2,a=this.height/2,n=new t.Object3D;let c=0;for(let e=0;e<this.width;e++)for(let o=0;o<this.height;o++){c++;const u=l(1,1),w=new t.Mesh(u,c===i?h.get("BaseUnitSelected"):h.get("BaseUnit"));w.translateX(.5-s+e),w.translateY(a-.5-o),w.rotateZ(r),n.add(w)}return f.positionBrickObject(n,e,s,a,!0),n},this.createPickingBaseSceneObject=i=>{const s=this.width/2,a=this.height/2,h=new t.Object3D;let n=0;for(let i=0;i<this.width;i++)for(let c=0;c<this.height;c++){n++;const o=e.createMaterialFromValue(n),u=l(1,1),w=new t.Mesh(u,o);w.translateX(.5-s+i),w.translateY(a-.5-c),w.rotateZ(r),h.add(w)}return f.positionBrickObject(h,i,s,a,!0),h}}},c=new t.Matrix4;c.set(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1);const o=[[]],l=(e,i)=>(void 0===o[e]&&(o[e]=[]),void 0===o[e][i]&&(o[e][i]=new t.PlaneBufferGeometry(e,i)),o[e][i]),u=new t.TextureLoader,w=async e=>{const i=await(async t=>u.loadAsync(t,null))(e);return new t.MeshStandardMaterial({map:i})},d=Math.PI,p=d/2,f=class{constructor(){this.textureMaterials=new Map,this.kitInfo=new class{},this.kitPieces=[]}async loadKit(t,e,i){this.kitInfo=await $.get(t);for(const t of i){const i=await w(e+t+".png");this.textureMaterials.set(t,i)}}static putOnLeft(t,e,i,s){i.translateZ(t),i.rotateX(p),i.rotateY(-p),i.translateZ(e),s.add(i)}static putOnRight(t,e,i,s){i.translateZ(t),i.rotateX(p),i.rotateY(p),i.translateZ(e),s.add(i)}static putOnFront(t,e,i,s){i.translateZ(t),i.rotateX(p),i.translateZ(e),s.add(i)}static putOnBack(t,e,i,s){i.translateZ(t),i.rotateX(p),i.rotateY(d),i.translateZ(e),s.add(i)}static putOnUp(t,e,i){e.translateZ(t),e.rotateZ(p),i.add(e)}static putOnDown(t,e){t.rotateZ(p),t.rotateX(d),e.add(t)}static createKitPieceBrickPlanes(t,e,i,s,a,r,n,c,o,l,u){return new h(t,e,i,s,a,r,n,c,o,l,u)}static createKitPieceFractionPlanes(t,e,i,s,a){return new n(t,e,i,s,a)}static positionBrickObject(t,e,i,s,a){switch(t.applyMatrix4(c),a||t.translateZ(1.2*e.positionZ),e.rotationZ){case 1:t.translateX(-i-e.positionX),t.translateY(-s-e.positionY);break;case 2:t.rotateZ(-p),t.translateX(i+e.positionY),t.translateY(-s-e.positionX);break;case 3:t.rotateZ(d),t.translateX(i+e.positionX),t.translateY(s+e.positionY);break;case 4:t.rotateZ(p),t.translateX(-i-e.positionY),t.translateY(s+e.positionX)}}static createKitPieceBrickConv(t,e,i,s,a,h){h.push(f.createKitPieceBrickPlanes(t,e,i,a,void 0,"h"+e+"v"+i+s,"h"+e+"v"+i+s,"h"+t+"v"+i+s,"h"+t+"v"+i+s,"h"+e+"h"+t+s,"h"+e+"h"+t+s))}static createCornerFrames(e,i,s,a,h){const r=.15,n=.25,c=.075,o=.125,u=s/2,w=a/2,p=1.2*h,v=p/2,M=6===h?5.6875:3.6875,g=4===a?3.7:2.7;let O=new t.Mesh(l(r,n),i.get("h0.15v0.1875BLcorner"));O.translateY(w-c),O.translateZ(-v+o),f.putOnLeft(v,u,O,e),O=new t.Mesh(l(r,n),i.get("h0.15v0.1875BLcorner")),O.translateY(-w+c),O.translateZ(-v+o),f.putOnRight(v,u,O,e),O=new t.Mesh(l(r,n),i.get("h0.15v0.1875BRcorner")),O.translateY(-w+c),O.translateZ(-v+o),f.putOnLeft(v,u,O,e),O=new t.Mesh(l(r,n),i.get("h0.15v0.1875BRcorner")),O.translateY(w-c),O.translateZ(-v+o),f.putOnRight(v,u,O,e),O=new t.Mesh(l(r,r),i.get("h0.15v0.125TLcorner")),O.translateY(w-c),O.translateZ(v-c),f.putOnLeft(v,u,O,e),O=new t.Mesh(l(r,r),i.get("h0.15v0.125TLcorner")),O.translateY(-w+c),O.translateZ(v-c),f.putOnRight(v,u,O,e),O=new t.Mesh(l(r,r),i.get("h0.15v0.125TRcorner")),O.translateY(-w+c),O.translateZ(v-c),f.putOnLeft(v,u,O,e),O=new t.Mesh(l(r,r),i.get("h0.15v0.125TRcorner")),O.translateY(w-c),O.translateZ(v-c),f.putOnRight(v,u,O,e),O=new t.Mesh(l(a-.3,n),i.get("h"+g+"v0.1875Bside")),O.translateZ(-v+o),f.putOnLeft(v,u,O,e),O=new t.Mesh(l(a-.3,n),i.get("h"+g+"v0.1875Bside")),O.translateZ(-v+o),f.putOnRight(v,u,O,e),O=new t.Mesh(l(a-.3,r),i.get("h"+g+"v0.125Tside")),O.translateZ(v-c),f.putOnLeft(v,u,O,e),O=new t.Mesh(l(a-.3,r),i.get("h"+g+"v0.125Tside")),O.translateZ(v-c),f.putOnRight(v,u,O,e),O=new t.Mesh(l(r,p-.4),i.get("h0.15v"+M+"Lside")),O.translateY(w-c),O.translateZ(.05),f.putOnLeft(v,u,O,e),O=new t.Mesh(l(r,p-.4),i.get("h0.15v"+M+"Lside")),O.translateY(-w+c),O.translateZ(.05),f.putOnRight(v,u,O,e),O=new t.Mesh(l(r,p-.4),i.get("h0.15v"+M+"Lside")),O.translateY(-w+c),O.translateZ(.05),f.putOnLeft(v,u,O,e),O=new t.Mesh(l(r,p-.4),i.get("h0.15v"+M+"Lside")),O.translateY(w-c),O.translateZ(.05),f.putOnRight(v,u,O,e),O=new t.Mesh(l(a-.3,1),i.get("h"+g+"h1.0face")),O.translateZ(n),O.rotateX(d),f.putOnDown(O,e),O=new t.Mesh(l(a-.3,1),i.get("h"+g+"h1.0face")),O.translateZ(-r),f.putOnUp(p,O,e),O.rotateX(d),O=new t.Mesh(l(1,p-.4),i.get("h1.0v"+M+"face")),O.translateY(r),O.translateZ(.05),f.putOnFront(v,w,O,e),O.rotateY(d),O=new t.Mesh(l(1,p-.4),i.get("h1.0v"+M+"face")),O.translateY(-r),O.translateZ(.05),f.putOnBack(v,w,O,e),O.rotateY(d)}static createPaverObject(e,i,s,a){const h=.4142135624,r=new Float32Array([-h,-1,0,h,-1,0,0,0,0,-1,-h,0,-h,-1,0,0,0,0,-1,h,0,-1,-h,0,0,0,0,-h,1,0,-1,h,0,0,0,0,h,1,0,-h,1,0,0,0,0,1,h,0,h,1,0,0,0,0,1,-h,0,1,h,0,0,0,0,h,-1,0,1,-h,0,0,0,0,1,-h,0,h,-1,0,1,-1,0,h,1,0,1,h,0,1,1,0,-1,h,0,-h,1,0,-1,1,0,-h,-1,0,-1,-h,0,-1,-1,0]),n=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]),c=new Float32Array([0,1,1,1,.5,.5,0,1,1,1,.5,.5,0,1,1,1,.5,.5,0,1,1,1,.5,.5,0,1,1,1,.5,.5,0,1,1,1,.5,.5,0,1,1,1,.5,.5,0,1,1,1,.5,.5,0,.125,.25,.125,.125,0,0,.125,.25,.125,.125,0,0,.125,.25,.125,.125,0,0,.125,.25,.125,.125,0]),o=new t.BufferGeometry;return o.setAttribute("position",new t.BufferAttribute(r,3)),o.setAttribute("normal",new t.BufferAttribute(n,3)),o.setAttribute("uv",new t.BufferAttribute(c,2)),new t.Mesh(o,e.get("h2h2p1"+a))}},v=["h1h2f0white","h2h2f0white","h2v1blue","h2v1red","h2v1white","h3h2f0white","h4h2f0white","h6h2f2blue","h6h2f2red","h6v1f2blue","h6v1f4blue","h6v1f2red","h6v1f4red","h8h2f4blue","h8h2f4red","h2h2p1blue","h2h2p1red","h2h2p1white","h8h2white","h8v1f4blue","h8v1f4red","h8v1white","BaseUnit","BaseUnitSelected"],M=async()=>{const t=new f;await t.loadKit("kits/kit-o004-a6QVnB6D/info.json","kits/kit-o004-a6QVnB6D/assets/images/",v);t.kitPieces.push(f.createKitPieceBrickPlanes(2,8,1,t.textureMaterials,(e=>{for(let i=0;i<4;i++){const s=f.createPaverObject(t.textureMaterials,2,2,"white");f.putOnUp(1.2,s,e),s.translateX(2*i-3)}}),"h8v1white","h8v1white","h2v1white","h2v1white",void 0,"h8h2white"));t.kitPieces.push(f.createKitPieceBrickPlanes(2,8,1,t.textureMaterials,(e=>{for(let i=0;i<4;i++){const s=f.createPaverObject(t.textureMaterials,2,2,"blue");f.putOnUp(1.2,s,e),s.translateX(2*i-3)}}),"h8v1white","h8v1white","h2v1white","h2v1white",void 0,"h8h2white"));return t.kitPieces.push(f.createKitPieceBrickPlanes(2,8,1,t.textureMaterials,(e=>{for(let i=0;i<4;i++){const s=f.createPaverObject(t.textureMaterials,2,2,"red");f.putOnUp(1.2,s,e),s.translateX(2*i-3)}}),"h8v1white","h8v1white","h2v1white","h2v1white",void 0,"h8h2white")),t.kitPieces.push(f.createKitPieceBrickPlanes(2,8,1,t.textureMaterials,void 0,"h8v1f4blue","h8v1f4blue","h2v1blue","h2v1blue","h8h2f4blue","h8h2f4blue")),t.kitPieces.push(f.createKitPieceBrickPlanes(2,8,1,t.textureMaterials,void 0,"h8v1f4red","h8v1f4red","h2v1red","h2v1red","h8h2f4red","h8h2f4red")),t.kitPieces.push(f.createKitPieceBrickPlanes(2,6,1,t.textureMaterials,void 0,"h6v1f2blue","h6v1f4blue","h2v1blue","h2v1blue","h6h2f2blue","h6h2f2blue")),t.kitPieces.push(f.createKitPieceBrickPlanes(2,6,1,t.textureMaterials,void 0,"h6v1f2red","h6v1f4red","h2v1red","h2v1red","h6h2f2red","h6h2f2red")),t.kitPieces.push(f.createKitPieceFractionPlanes(2,1,t.textureMaterials,"h1h2f0white")),t.kitPieces.push(f.createKitPieceFractionPlanes(2,2,t.textureMaterials,"h2h2f0white")),t.kitPieces.push(f.createKitPieceFractionPlanes(2,3,t.textureMaterials,"h3h2f0white")),t.kitPieces.push(f.createKitPieceFractionPlanes(2,4,t.textureMaterials,"h4h2f0white")),t};export{M as loadKit};
